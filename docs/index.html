<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de Gesti√≥n de Expedientes TSJ Quintana Roo - Versi√≥n Web">
    <meta name="theme-color" content="#366092">
    <title>TSJ Filing Online - Gesti√≥n de Expedientes</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öñÔ∏è</text></svg>">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-brand">
            <span class="brand-icon">‚öñÔ∏è</span>
            <div class="brand-text">
                <h1>TSJ Filing Online</h1>
                <span class="brand-subtitle">Quintana Roo - v7.0</span>
            </div>
        </div>
        <nav class="header-nav">
            <button class="nav-btn active" data-page="inicio">üè† Inicio</button>
            <button class="nav-btn" data-page="expedientes">üìÅ Expedientes</button>
            <button class="nav-btn" data-page="calendario">üìÖ Calendario</button>
            <button class="nav-btn" data-page="notas">üìù Notas</button>
            <button class="nav-btn" data-page="busqueda">üîç B√∫squeda</button>
            <button class="nav-btn" data-page="config">‚öôÔ∏è</button>
        </nav>
        <button class="menu-toggle" id="menuToggle">‚ò∞</button>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
        <button class="nav-btn active" data-page="inicio">üè† Inicio</button>
        <button class="nav-btn" data-page="expedientes">üìÅ Expedientes</button>
        <button class="nav-btn" data-page="calendario">üìÖ Calendario</button>
        <button class="nav-btn" data-page="notas">üìù Notas</button>
        <button class="nav-btn" data-page="busqueda">üîç B√∫squeda</button>
        <button class="nav-btn" data-page="config">‚öôÔ∏è Configuraci√≥n</button>
    </nav>

    <!-- Main Content -->
    <main class="app-main">
        <!-- P√°gina Inicio -->
        <section class="page active" id="page-inicio">
            <div class="page-header">
                <h2>Panel de Control</h2>
                <p class="subtitle">Bienvenido al Sistema de Gesti√≥n de Expedientes</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: #e3f2fd;">üìÅ</div>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-expedientes">0</span>
                        <span class="stat-label">Expedientes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #e8f5e9;">üìÖ</div>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-eventos">0</span>
                        <span class="stat-label">Eventos Pr√≥ximos</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #fff3e0;">üìù</div>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-notas">0</span>
                        <span class="stat-label">Notas</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #fce4ec;">üîî</div>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-alertas">0</span>
                        <span class="stat-label">Alertas</span>
                    </div>
                </div>
            </div>

            <div class="quick-actions">
                <h3>Acciones R√°pidas</h3>
                <div class="actions-grid">
                    <button class="action-card" onclick="navegarA('expedientes'); mostrarFormularioExpediente()">
                        <span class="action-icon">‚ûï</span>
                        <span>Nuevo Expediente</span>
                    </button>
                    <button class="action-card primary" onclick="navegarA('busqueda')">
                        <span class="action-icon">üîç</span>
                        <span>Buscar en TSJ</span>
                    </button>
                    <button class="action-card" onclick="navegarA('calendario')">
                        <span class="action-icon">üìÖ</span>
                        <span>Ver Calendario</span>
                    </button>
                    <button class="action-card" onclick="navegarA('notas'); mostrarFormularioNota()">
                        <span class="action-icon">üìù</span>
                        <span>Nueva Nota</span>
                    </button>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>üìÖ Pr√≥ximos 8 D√≠as</h3>
                    </div>
                    <div class="card-body" id="eventos-hoy" style="max-height: 300px; overflow-y: auto;">
                        <div class="empty-state small">
                            <span>üéâ</span>
                            <p>No hay eventos pr√≥ximos</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3>üìÅ Expedientes Recientes</h3>
                    </div>
                    <div class="card-body" id="expedientes-recientes">
                        <div class="empty-state small">
                            <span>üìÇ</span>
                            <p>No hay expedientes</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-banner">
                <div class="info-icon">üí°</div>
                <div class="info-content">
                    <div class="header-with-help">
                        <h4>Base de Datos Local</h4>
                        <div class="tooltip-container">
                            <button class="help-btn" type="button">?</button>
                            <div class="tooltip-content tooltip-bottom">
                                <h4>Sobre tus datos</h4>
                                <p>Tus datos se guardan en <strong>IndexedDB</strong>, una base de datos del navegador.</p>
                                <p><strong>Ventajas:</strong></p>
                                <ul>
                                    <li>Sin registro ni cuenta</li>
                                    <li>Privacidad total - datos solo en tu equipo</li>
                                    <li>Funciona sin internet</li>
                                </ul>
                                <p><strong>Importante:</strong></p>
                                <ul>
                                    <li>Haz respaldos peri√≥dicos (Configuraci√≥n ‚Üí Exportar)</li>
                                    <li>Limpiar datos del navegador borra todo</li>
                                    <li>Los datos NO se sincronizan entre dispositivos</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <p>Todos tus datos se guardan autom√°ticamente en tu navegador. No necesitas instalar nada.</p>
                </div>
            </div>
        </section>

        <!-- P√°gina Expedientes -->
        <section class="page" id="page-expedientes">
            <div class="page-header">
                <div>
                    <h2>üìÅ Expedientes</h2>
                    <p class="subtitle">Gestiona tus expedientes del TSJ</p>
                </div>
                <div class="header-buttons">
                    <div class="tooltip-container">
                        <button class="btn btn-secondary" onclick="descargarTemplateCSV()">
                            üìÑ Descargar Template
                        </button>
                        <div class="tooltip-content tooltip-bottom tooltip-right">
                            <h4>¬øC√≥mo usar la carga masiva?</h4>
                            <p><strong>Paso 1:</strong> Descarga el template CSV</p>
                            <p><strong>Paso 2:</strong> √Åbrelo con Excel o Google Sheets</p>
                            <p><strong>Paso 3:</strong> Completa las columnas:</p>
                            <ul>
                                <li><code>expediente</code>: N√∫mero (ej: 1234/2025) o nombre</li>
                                <li><code>tipo</code>: "numero" o "nombre"</li>
                                <li><code>juzgado</code>: Nombre EXACTO del juzgado (ver lista en el template)</li>
                                <li><code>comentario</code>: Notas opcionales</li>
                            </ul>
                            <p><strong>Paso 4:</strong> Guarda como CSV e importa</p>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="document.getElementById('import-csv').click()">
                        üì• Importar CSV/Excel
                    </button>
                    <input type="file" id="import-csv" accept=".csv,.xlsx,.xls" style="display:none" onchange="importarExpedientesCSV(event)">
                    <button class="btn btn-primary" onclick="mostrarFormularioExpediente()">
                        ‚ûï Nuevo Expediente
                    </button>
                </div>
            </div>

            <!-- Formulario Nuevo Expediente -->
            <div class="card form-card" id="form-expediente" style="display: none;">
                <div class="card-header">
                    <h3 id="form-expediente-titulo">Agregar Nuevo Expediente</h3>
                    <button class="btn-close" onclick="cerrarFormularioExpediente()">‚úï</button>
                </div>
                <div class="card-body">
                    <form id="expediente-form" onsubmit="guardarExpediente(event)">
                        <input type="hidden" id="expediente-id">

                        <div class="form-row">
                            <div class="form-group">
                                <label>Tipo de b√∫squeda</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="tipo-busqueda" value="numero" checked>
                                        <span>Por N√∫mero</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="tipo-busqueda" value="nombre">
                                        <span>Por Nombre</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="expediente-valor" id="label-valor">N√∫mero de Expediente</label>
                                <input type="text" id="expediente-valor" placeholder="Ej: 1234/2025" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="expediente-juzgado">Juzgado</label>
                                <select id="expediente-juzgado" required>
                                    <option value="">Selecciona un juzgado...</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="expediente-comentario">Comentario (opcional)</label>
                                <input type="text" id="expediente-comentario" placeholder="Notas adicionales...">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="cerrarFormularioExpediente()">Cancelar</button>
                            <button type="submit" class="btn btn-success">üíæ Guardar</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters-section">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="buscar-expediente" placeholder="Buscar expedientes..." oninput="filtrarExpedientes()">
                </div>
                <select id="filtro-categoria" onchange="filtrarExpedientes()">
                    <option value="">Todas las categor√≠as</option>
                </select>
                <span class="results-count" id="count-expedientes">0 expedientes</span>
            </div>

            <!-- Lista de Expedientes -->
            <div class="expedientes-grid" id="lista-expedientes">
                <div class="empty-state">
                    <span class="empty-icon">üìÇ</span>
                    <h3>No hay expedientes</h3>
                    <p>Comienza agregando tu primer expediente</p>
                    <button class="btn btn-primary" onclick="mostrarFormularioExpediente()">
                        ‚ûï Agregar Expediente
                    </button>
                </div>
            </div>
        </section>

        <!-- P√°gina Calendario -->
        <section class="page" id="page-calendario">
            <div class="page-header">
                <div>
                    <h2>üìÖ Calendario</h2>
                    <p class="subtitle">Gestiona tus eventos y recordatorios</p>
                </div>
                <button class="btn btn-primary" onclick="mostrarFormularioEvento()">
                    ‚ûï Nuevo Evento
                </button>
            </div>

            <div class="calendario-nav">
                <button class="btn btn-secondary" onclick="mesAnterior()">‚óÄ Anterior</button>
                <h3 id="mes-actual">Enero 2025</h3>
                <button class="btn btn-secondary" onclick="irAHoy()">Hoy</button>
                <button class="btn btn-secondary" onclick="mesSiguiente()">Siguiente ‚ñ∂</button>
            </div>

            <div class="calendario-container">
                <div class="calendario">
                    <div class="calendario-header">
                        <div>Dom</div>
                        <div>Lun</div>
                        <div>Mar</div>
                        <div>Mi√©</div>
                        <div>Jue</div>
                        <div>Vie</div>
                        <div>S√°b</div>
                    </div>
                    <div class="calendario-body" id="calendario-dias">
                        <!-- D√≠as generados por JS -->
                    </div>
                </div>

                <div class="eventos-panel">
                    <h3 id="eventos-panel-titulo">Eventos del Mes</h3>
                    <div class="eventos-lista" id="lista-eventos-panel">
                        <div class="empty-state small">
                            <span>üì≠</span>
                            <p>No hay eventos</p>
                        </div>
                    </div>

                    <div class="leyenda">
                        <h4>Tipos de Evento</h4>
                        <div class="leyenda-items">
                            <div class="leyenda-item"><span class="leyenda-color" style="background: #3788d8;"></span> ‚öñÔ∏è Audiencia</div>
                            <div class="leyenda-item"><span class="leyenda-color" style="background: #dc3545;"></span> ‚ö†Ô∏è Vencimiento</div>
                            <div class="leyenda-item"><span class="leyenda-color" style="background: #ffc107;"></span> üîî Recordatorio</div>
                            <div class="leyenda-item"><span class="leyenda-color" style="background: #6c757d;"></span> üìå Otro</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- P√°gina Notas -->
        <section class="page" id="page-notas">
            <div class="page-header">
                <div>
                    <h2>üìù Notas</h2>
                    <p class="subtitle">Organiza tus notas por expediente</p>
                </div>
                <button class="btn btn-primary" onclick="mostrarFormularioNota()">
                    ‚ûï Nueva Nota
                </button>
            </div>

            <!-- Filtros -->
            <div class="filters-section">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="buscar-nota" placeholder="Buscar notas..." oninput="filtrarNotas()">
                </div>
                <select id="filtro-expediente-nota" onchange="filtrarNotas()">
                    <option value="">Todos los expedientes</option>
                </select>
                <span class="results-count" id="count-notas">0 notas</span>
            </div>

            <!-- Lista de Notas -->
            <div class="notas-grid" id="lista-notas">
                <div class="empty-state">
                    <span class="empty-icon">üìí</span>
                    <h3>No hay notas</h3>
                    <p>Comienza creando tu primera nota</p>
                    <button class="btn btn-primary" onclick="mostrarFormularioNota()">
                        ‚ûï Crear Nota
                    </button>
                </div>
            </div>
        </section>

        <!-- P√°gina B√∫squeda -->
        <section class="page" id="page-busqueda">
            <div class="page-header">
                <div>
                    <h2>üîç B√∫squeda en TSJ</h2>
                    <p class="subtitle">Busca publicaciones en el TSJ de Quintana Roo</p>
                </div>
            </div>

            <!-- B√∫squeda Global -->
            <div class="card">
                <div class="card-header">
                    <div class="header-with-help">
                        <h3>üåê B√∫squeda Global (Investigaci√≥n)</h3>
                        <div class="tooltip-container">
                            <button class="help-btn" type="button">?</button>
                            <div class="tooltip-content tooltip-left">
                                <h4>¬øPara qu√© sirve la B√∫squeda Global?</h4>
                                <p>Esta funci√≥n te permite <strong>investigar</strong> buscando en TODOS los juzgados y salas al mismo tiempo.</p>
                                <p><strong>Casos de uso:</strong></p>
                                <ul>
                                    <li>Buscar todas las causas de una persona</li>
                                    <li>Verificar si existe un expediente (sin saber el juzgado)</li>
                                    <li>Investigar antecedentes legales</li>
                                </ul>
                                <p><strong>Nota:</strong> Abre m√∫ltiples ventanas. El navegador puede bloquear popups - permite las ventanas emergentes del sitio TSJ.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p class="section-desc">Busca un n√∫mero de expediente o nombre en TODOS los juzgados y salas a la vez.</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo de b√∫squeda</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="tipo-busqueda-global" value="numero" checked>
                                    <span>Por N√∫mero</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="tipo-busqueda-global" value="nombre">
                                    <span>Por Nombre</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Valor a buscar</label>
                            <input type="text" id="busqueda-global-valor" placeholder="Ej: 1234/2025 o Juan P√©rez">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Buscar en</label>
                            <select id="busqueda-global-ambito">
                                <option value="todos">Todos (Primera + Segunda Instancia)</option>
                                <option value="primera">Solo Primera Instancia</option>
                                <option value="segunda">Solo Segunda Instancia (Salas)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-success btn-lg" onclick="ejecutarBusquedaGlobal()">
                        üåê Buscar en Todos los Juzgados
                    </button>
                </div>
            </div>

            <hr class="section-divider">

            <!-- B√∫squeda por Expedientes Guardados -->
            <div class="card">
                <div class="card-header">
                    <div class="header-with-help">
                        <h3>üìÅ Buscar Expedientes Guardados</h3>
                        <div class="tooltip-container">
                            <button class="help-btn" type="button">?</button>
                            <div class="tooltip-content">
                                <h4>B√∫squeda R√°pida</h4>
                                <p>Selecciona uno o m√°s expedientes de tu lista y genera las URLs de b√∫squeda del TSJ.</p>
                                <p><strong>Opciones:</strong></p>
                                <ul>
                                    <li><strong>Ver:</strong> Abre los resultados en una ventana popup</li>
                                    <li><strong>Copiar:</strong> Copia el enlace al portapapeles</li>
                                    <li><strong>Abrir Todas:</strong> Abre todas las b√∫squedas seleccionadas</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-sm btn-secondary" onclick="seleccionarTodosExpedientes()">
                            ‚úì Seleccionar todos
                        </button>
                        <span class="selection-count" id="count-seleccionados">0 seleccionados</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="expedientes-seleccion" id="expedientes-busqueda">
                        <div class="empty-state small">
                            <span>üìÇ</span>
                            <p>No hay expedientes. Agrega algunos primero.</p>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-primary btn-lg" onclick="generarURLsBusqueda()">
                        üîó Generar URLs de B√∫squeda
                    </button>
                </div>
            </div>

            <!-- URLs Generadas -->
            <div class="card" id="urls-generadas" style="display: none;">
                <div class="card-header">
                    <h3>üîó Resultados de B√∫squeda</h3>
                    <div class="header-actions">
                        <button class="btn btn-sm btn-secondary" onclick="copiarTodasURLs()">üìã Copiar URLs</button>
                        <button class="btn btn-sm btn-success" onclick="abrirTodasBusquedas()">üöÄ Abrir Todas</button>
                    </div>
                </div>
                <div class="card-body">
                    <p class="manual-instructions">Haz clic en "Ver" para abrir los resultados del TSJ en una ventana popup.</p>
                    <div class="urls-list" id="lista-urls">
                        <!-- URLs generadas por JS -->
                    </div>
                </div>
            </div>

            <hr class="section-divider">

            <!-- An√°lisis con IA -->
            <div class="card">
                <div class="card-header">
                    <div class="header-with-help">
                        <h3>ü§ñ Analizar Acuerdo con IA</h3>
                        <div class="tooltip-container">
                            <button class="help-btn" type="button">?</button>
                            <div class="tooltip-content tooltip-left">
                                <h4>¬øC√≥mo usar el an√°lisis con IA?</h4>
                                <p><strong>Paso 1:</strong> Configura tu API Key de Groq en Configuraci√≥n (es gratis)</p>
                                <p><strong>Paso 2:</strong> Busca tu expediente y copia el texto del acuerdo</p>
                                <p><strong>Paso 3:</strong> Pega el texto aqu√≠ y haz clic en "Analizar"</p>
                                <p><strong>La IA extraer√°:</strong></p>
                                <ul>
                                    <li>Fechas de audiencias</li>
                                    <li>Vencimientos de plazos</li>
                                    <li>Puntos importantes del acuerdo</li>
                                </ul>
                                <p>Puedes guardar autom√°ticamente como eventos y notas.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p class="section-desc">Pega el texto de un acuerdo del TSJ y la IA extraer√° autom√°ticamente fechas, audiencias y puntos importantes.</p>
                    <div class="form-group">
                        <label>Expediente relacionado (opcional)</label>
                        <select id="ia-expediente" onchange="toggleExpedienteCustom('ia')">
                            <option value="">Sin expediente espec√≠fico</option>
                            <option value="__custom__">‚úèÔ∏è Otro (escribir manualmente)</option>
                        </select>
                    </div>
                    <div class="form-group" id="ia-expediente-custom-group" style="display: none;">
                        <label>N√∫mero de expediente</label>
                        <input type="text" id="ia-expediente-custom" placeholder="Ej: 123/2025">
                    </div>
                    <div class="form-group">
                        <label>Texto del Acuerdo</label>
                        <textarea id="ia-texto-acuerdo" rows="8" placeholder="Pega aqu√≠ el texto del acuerdo copiado del sitio del TSJ..."></textarea>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-primary btn-lg" onclick="analizarAcuerdoConIA()" id="btn-analizar-ia">
                        ü§ñ Analizar con IA
                    </button>
                </div>
            </div>

            <!-- Resultados del An√°lisis IA -->
            <div class="card" id="resultados-ia" style="display: none;">
                <div class="card-header">
                    <h3>üìã Resultados del An√°lisis</h3>
                </div>
                <div class="card-body" id="resultados-ia-contenido">
                    <!-- Resultados generados por JS -->
                </div>
                <div class="card-footer">
                    <button class="btn btn-success" onclick="guardarResultadosIA()">üíæ Guardar Todo</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('resultados-ia').style.display='none'">Cerrar</button>
                </div>
            </div>
        </section>

        <!-- P√°gina Configuraci√≥n -->
        <section class="page" id="page-config">
            <div class="page-header">
                <h2>‚öôÔ∏è Configuraci√≥n</h2>
                <p class="subtitle">Personaliza tu experiencia</p>
            </div>

            <div class="config-section">
                <h3>üîî Notificaciones</h3>
                <div class="config-item">
                    <div class="config-info">
                        <h4>Notificaciones del navegador</h4>
                        <p>Recibe alertas cuando haya eventos pr√≥ximos</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="config-notificaciones" onchange="toggleNotificaciones()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="config-section">
                <div class="header-with-help">
                    <h3>üíæ Datos</h3>
                    <div class="tooltip-container">
                        <button class="help-btn" type="button">?</button>
                        <div class="tooltip-content tooltip-left">
                            <h4>Respaldos de Seguridad</h4>
                            <p><strong>¬øPor qu√© respaldar?</strong></p>
                            <ul>
                                <li>Tus datos solo existen en este navegador</li>
                                <li>Limpiar cach√©/cookies borra todo</li>
                                <li>Cambiar de computadora requiere migrar datos</li>
                            </ul>
                            <p><strong>Recomendaci√≥n:</strong> Exporta tus datos semanalmente y guarda el archivo JSON en un lugar seguro.</p>
                        </div>
                    </div>
                </div>
                <div class="data-actions">
                    <div class="data-card">
                        <div class="data-icon">üì§</div>
                        <div class="data-info">
                            <h4>Exportar Datos</h4>
                            <p>Descarga todos tus datos en JSON</p>
                        </div>
                        <button class="btn btn-primary" onclick="exportarDatos()">Exportar</button>
                    </div>
                    <div class="data-card">
                        <div class="data-icon">üì•</div>
                        <div class="data-info">
                            <h4>Importar Datos</h4>
                            <p>Restaura desde un archivo de respaldo</p>
                        </div>
                        <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">Importar</button>
                        <input type="file" id="import-file" accept=".json" style="display:none" onchange="importarDatos(event)">
                    </div>
                </div>

                <div class="config-item" style="margin-top: 1rem;">
                    <div class="config-info">
                        <h4>üîÑ Respaldo Autom√°tico Diario</h4>
                        <p>Descarga autom√°ticamente un respaldo cada d√≠a al abrir la app</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="config-auto-backup" onchange="toggleAutoBackup()">
                        <span class="slider"></span>
                    </label>
                </div>
                <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.5rem;" id="ultimo-respaldo-info"></p>
            </div>

            <div class="config-section">
                <div class="header-with-help">
                    <h3>ü§ñ Inteligencia Artificial (Groq)</h3>
                    <div class="tooltip-container">
                        <button class="help-btn" type="button">?</button>
                        <div class="tooltip-content tooltip-left">
                            <h4>¬øC√≥mo obtener tu API Key de Groq?</h4>
                            <p><strong>Groq es GRATIS</strong> y muy r√°pido. Sigue estos pasos:</p>
                            <ul>
                                <li>Ve a <a href="https://console.groq.com/keys" target="_blank">console.groq.com/keys</a></li>
                                <li>Crea una cuenta con Google o email</li>
                                <li>Haz clic en "Create API Key"</li>
                                <li>Copia la clave (empieza con <code>gsk_</code>)</li>
                                <li>P√©gala aqu√≠ y guarda</li>
                            </ul>
                            <p>Usa la funci√≥n "Probar Conexi√≥n" para verificar que funciona.</p>
                        </div>
                    </div>
                </div>
                <p class="section-desc">Analiza acuerdos autom√°ticamente y extrae fechas, audiencias y notas importantes. <a href="https://console.groq.com/keys" target="_blank">Obtener API Key gratis</a></p>
                <form id="ai-config-form" onsubmit="guardarConfigIA(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>API Key de Groq</label>
                            <input type="password" id="groq-api-key" placeholder="gsk_xxxxxxxxxxxxxxxx">
                        </div>
                        <div class="form-group">
                            <label>Modelo</label>
                            <select id="groq-model">
                                <option value="llama-3.3-70b-versatile">Llama 3.3 70B (Recomendado)</option>
                                <option value="llama-3.1-8b-instant">Llama 3.1 8B (M√°s r√°pido)</option>
                                <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">üíæ Guardar</button>
                        <button type="button" class="btn btn-secondary" onclick="probarIA()">üß™ Probar Conexi√≥n</button>
                    </div>
                </form>
            </div>

            <div class="config-section">
                <div class="header-with-help">
                    <h3>‚è∞ B√∫squedas Programadas</h3>
                    <div class="tooltip-container">
                        <button class="help-btn" type="button">?</button>
                        <div class="tooltip-content tooltip-left">
                            <h4>¬øC√≥mo funcionan las b√∫squedas autom√°ticas?</h4>
                            <p>Esta funci√≥n abre autom√°ticamente las b√∫squedas de tus expedientes en intervalos regulares.</p>
                            <p><strong>Requisitos:</strong></p>
                            <ul>
                                <li>La p√°gina debe estar abierta</li>
                                <li>Debes tener expedientes guardados</li>
                                <li>Permite ventanas emergentes del TSJ</li>
                            </ul>
                            <p><strong>Ideal para:</strong> Monitorear actualizaciones de m√∫ltiples expedientes sin tener que buscar manualmente cada vez.</p>
                        </div>
                    </div>
                </div>
                <p class="section-desc">Programa b√∫squedas autom√°ticas de tus expedientes</p>
                <div class="config-item">
                    <div class="config-info">
                        <h4>Activar b√∫squedas autom√°ticas</h4>
                        <p>Abre las b√∫squedas de tus expedientes peri√≥dicamente</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="config-busquedas-auto" onchange="toggleBusquedasAuto()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div id="config-busquedas-opciones" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Frecuencia</label>
                            <select id="busqueda-frecuencia" onchange="guardarFrecuenciaBusqueda()">
                                <option value="30">Cada 30 minutos</option>
                                <option value="60">Cada hora</option>
                                <option value="120">Cada 2 horas</option>
                                <option value="240">Cada 4 horas</option>
                                <option value="480">Cada 8 horas</option>
                                <option value="1440">Cada 24 horas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>√öltima b√∫squeda</label>
                            <span id="ultima-busqueda-auto">Nunca</span>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" onclick="ejecutarBusquedaAhora()">üîç Buscar Ahora</button>
                    </div>
                </div>
            </div>

            <div class="config-section">
                <div class="header-with-help">
                    <h3>üìß Email (EmailJS)</h3>
                    <div class="tooltip-container">
                        <button class="help-btn" type="button">?</button>
                        <div class="tooltip-content tooltip-left">
                            <h4>¬øQu√© es EmailJS?</h4>
                            <p>EmailJS te permite recibir <strong>recordatorios por email</strong> sin necesidad de un servidor.</p>
                            <p><strong>¬øPara qu√© sirve?</strong></p>
                            <ul>
                                <li>Recibir alertas de eventos del calendario</li>
                                <li>Recordatorios de vencimientos</li>
                                <li>Notificaciones importantes</li>
                            </ul>
                            <p><strong>Configuraci√≥n (5 min):</strong></p>
                            <ul>
                                <li>Crea cuenta en <a href="https://www.emailjs.com/" target="_blank">emailjs.com</a></li>
                                <li>Conecta tu email (Gmail, Outlook, etc.)</li>
                                <li>Crea un "Email Service" y copia el ID</li>
                                <li>Crea un "Template" y copia el ID</li>
                                <li>Copia tu "Public Key" de Account</li>
                            </ul>
                            <p>Plan gratis: 200 emails/mes</p>
                        </div>
                    </div>
                </div>
                <p class="section-desc">Configura para recibir recordatorios por correo (200 emails/mes gratis)</p>
                <form id="email-config-form" onsubmit="guardarConfigEmail(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Service ID</label>
                            <input type="text" id="email-service-id" placeholder="service_xxxxxxx">
                        </div>
                        <div class="form-group">
                            <label>Public Key</label>
                            <input type="text" id="email-public-key" placeholder="Tu clave p√∫blica">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Template ID</label>
                            <input type="text" id="email-template-id" placeholder="template_xxxxxxx">
                        </div>
                        <div class="form-group">
                            <label>Tu Email</label>
                            <input type="email" id="email-destino" placeholder="tu@email.com">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">üíæ Guardar</button>
                        <button type="button" class="btn btn-secondary" onclick="probarEmail()">üìß Probar</button>
                    </div>
                </form>
            </div>

            <div class="config-section premium-section" id="premium-section">
                <div class="header-with-help">
                    <h3>‚≠ê Plan Premium</h3>
                    <div class="tooltip-container">
                        <button class="help-btn" type="button">?</button>
                        <div class="tooltip-content tooltip-left">
                            <h4>¬øQu√© incluye Premium?</h4>
                            <p><strong>Plan Gratuito:</strong></p>
                            <ul>
                                <li>Hasta 10 expedientes</li>
                                <li>10 b√∫squedas globales</li>
                                <li>Todas las dem√°s funciones</li>
                            </ul>
                            <p><strong>Plan Premium ($35/mes):</strong></p>
                            <ul>
                                <li>Expedientes ilimitados</li>
                                <li>B√∫squedas globales ilimitadas</li>
                                <li>Soporte prioritario</li>
                            </ul>
                            <p>Contacta para obtener tu c√≥digo de activaci√≥n despu√©s de realizar el pago.</p>
                        </div>
                    </div>
                </div>

                <!-- Estado del plan -->
                <div class="plan-status" id="plan-status">
                    <div class="plan-badge free" id="plan-badge">
                        <span class="badge-icon">üÜì</span>
                        <span class="badge-text">Plan Gratuito</span>
                    </div>
                    <div class="plan-limits" id="plan-limits">
                        <div class="limit-item">
                            <span class="limit-label">Expedientes:</span>
                            <span class="limit-value" id="limit-expedientes">0 / 10</span>
                            <div class="limit-bar"><div class="limit-fill" id="limit-fill-exp" style="width: 0%"></div></div>
                        </div>
                        <div class="limit-item">
                            <span class="limit-label">B√∫squedas globales:</span>
                            <span class="limit-value" id="limit-busquedas">0 / 10</span>
                            <div class="limit-bar"><div class="limit-fill" id="limit-fill-bus" style="width: 0%"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Activaci√≥n Premium -->
                <div class="premium-activation" id="premium-activation">
                    <p class="section-desc">¬øYa tienes un c√≥digo de activaci√≥n? Ingr√©salo aqu√≠:</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tu nombre o identificador</label>
                            <input type="text" id="premium-username" placeholder="Ej: Juan P√©rez o Despacho ABC">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>C√≥digo de activaci√≥n</label>
                            <input type="text" id="premium-code" placeholder="Ingresa tu c√≥digo...">
                        </div>
                        <button class="btn btn-success" onclick="activarPremium()">‚≠ê Activar</button>
                    </div>
                    <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.5rem;">
                        üîí El c√≥digo quedar√° vinculado a este dispositivo y no podr√° usarse en otro.
                    </p>
                    <p class="device-id-display" id="device-id-display" style="font-size: 0.7rem; color: var(--text-muted);"></p>
                </div>

                <!-- Info de compra y precios -->
                <div class="premium-buy" id="premium-buy">
                    <h4 style="margin-bottom: 1rem;">üí∞ Precios</h4>
                    <div class="pricing-table">
                        <div class="pricing-row header">
                            <span>Licencias</span>
                            <span>Precio c/u</span>
                            <span>Total/mes</span>
                        </div>
                        <div class="pricing-row">
                            <span>1 licencia</span>
                            <span>$35 MXN</span>
                            <span>$35 MXN</span>
                        </div>
                        <div class="pricing-row popular">
                            <span>2 licencias</span>
                            <span>$30 MXN</span>
                            <span>$60 MXN</span>
                        </div>
                        <div class="pricing-row">
                            <span>3 licencias</span>
                            <span>$25 MXN</span>
                            <span>$75 MXN</span>
                        </div>
                        <div class="pricing-row best">
                            <span>4+ licencias</span>
                            <span>$23 MXN</span>
                            <span>Contactar</span>
                        </div>
                    </div>
                    <div class="info-banner warning" style="margin-top: 1rem;">
                        <div class="info-icon">üí≥</div>
                        <div class="info-content">
                            <h4>¬øC√≥mo obtener Premium?</h4>
                            <p>1. Realiza tu pago por Stripe o transferencia</p>
                            <p>2. Recibir√°s tu c√≥digo por email</p>
                            <p>3. Ingresa tu nombre y c√≥digo arriba</p>
                            <a href="https://buy.stripe.com/test_XXXXXXX" target="_blank" class="btn btn-primary btn-sm" id="stripe-link" style="margin-top: 0.5rem;">
                                üí≥ Pagar con Stripe
                            </a>
                        </div>
                    </div>
                    <div class="info-banner" style="margin-top: 0.75rem; background: #f5f5f5; border-left-color: #6c757d;">
                        <div class="info-icon">üßæ</div>
                        <div class="info-content">
                            <h4>¬øNecesitas factura?</h4>
                            <p>Env√≠a tu solicitud con tus datos fiscales a: <a href="mailto:frida@empirica.mx" style="color: var(--primary); font-weight: 500;">frida@empirica.mx</a></p>
                        </div>
                    </div>
                </div>

                <!-- Estado Premium Activo -->
                <div class="premium-active" id="premium-active" style="display: none;">
                    <div class="info-banner" style="background: linear-gradient(135deg, #fff9c4 0%, #ffeb3b 100%); border-left-color: #ffc107;">
                        <div class="info-icon">‚≠ê</div>
                        <div class="info-content">
                            <h4>¬°Premium Activo!</h4>
                            <p>Tienes acceso ilimitado a todas las funciones.</p>
                            <p class="text-muted" id="premium-expiry">V√°lido hasta: --</p>
                            <p class="text-muted" id="premium-user" style="font-size: 0.75rem;"></p>
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="desactivarPremium()" style="margin-top: 0.5rem;">
                        Desactivar Premium
                    </button>
                </div>

                <!-- Transferencia de licencia -->
                <div class="transfer-section" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                    <p style="font-size: 0.85rem; color: var(--text-muted);">
                        üîÑ <strong>¬øCambiaste de dispositivo?</strong>
                    </p>
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                        Si tienes una licencia activa en otro dispositivo, puedes solicitar transferirla aqu√≠ (disponible cada 30 d√≠as).
                    </p>
                    <button class="btn btn-outline btn-sm" onclick="mostrarModalTransferencia()">
                        üîÑ Solicitar Transferencia
                    </button>
                </div>
            </div>

            <div class="config-section danger">
                <h3>‚ö†Ô∏è Zona de Peligro</h3>
                <div class="danger-item">
                    <div class="danger-info">
                        <h4>Eliminar todos los datos</h4>
                        <p>Esta acci√≥n no se puede deshacer</p>
                    </div>
                    <button class="btn btn-danger" onclick="eliminarTodosDatos()">üóëÔ∏è Eliminar Todo</button>
                </div>
            </div>

            <div class="config-section">
                <h3>‚ÑπÔ∏è Acerca de</h3>
                <div class="about-info">
                    <p><strong>TSJ Filing Online</strong> v7.0</p>
                    <p>Sistema de Gesti√≥n de Expedientes del TSJ Quintana Roo</p>
                    <p class="text-muted">Todos los datos se almacenan localmente en tu navegador usando IndexedDB.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Gen√©rico -->
    <div class="modal-overlay" id="modal-overlay" onclick="cerrarModal()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modal-titulo">Modal</h3>
                <button class="btn-close" onclick="cerrarModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Contenido din√°mico -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <!-- Botones din√°micos -->
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            <div class="footer-brand">
                <span class="footer-logo">‚öñÔ∏è</span>
                <div>
                    <strong>TSJ Filing Online v7.0</strong>
                    <p>Desarrollado por <a href="https://www.empirica.mx" target="_blank">Emp√≠rica Legal Lab</a></p>
                </div>
            </div>

            <div class="footer-contact">
                <h4>üìß Contacto y Soporte</h4>
                <p>Para activaci√≥n de cuentas Premium, soluci√≥n de problemas y dudas:</p>
                <p><a href="mailto:jorge_clemente@empirica.mx">jorge_clemente@empirica.mx</a></p>
                <p class="response-time">‚è±Ô∏è Tiempo de respuesta: 6-48 horas m√°ximo</p>
            </div>

            <div class="footer-links">
                <h4>üîó Enlaces</h4>
                <a href="https://www.empirica.mx" target="_blank">www.empirica.mx</a>
                <a href="https://www.tsjqroo.gob.mx" target="_blank">TSJ Quintana Roo</a>
            </div>
        </div>

        <div class="footer-legal">
            <div class="footer-disclaimer">
                <h4>‚ö†Ô∏è Aviso Legal y Descargo de Responsabilidad</h4>
                <p><strong>Uso bajo responsabilidad del usuario:</strong> Esta herramienta se proporciona "tal cual" sin garant√≠as de ning√∫n tipo. El uso de este sistema es bajo la exclusiva responsabilidad del usuario.</p>
                <p><strong>Datos del usuario:</strong> Toda la informaci√≥n contenida en las bases de datos locales es responsabilidad exclusiva de los propios usuarios. Emp√≠rica Legal Lab no tiene acceso a los datos almacenados en tu navegador y no se hace responsable de su precisi√≥n, integridad o p√©rdida.</p>
                <p><strong>Informaci√≥n del TSJ:</strong> Los resultados de b√∫squeda provienen directamente del sitio oficial del Tribunal Superior de Justicia de Quintana Roo. No garantizamos la exactitud ni la actualizaci√≥n de dicha informaci√≥n.</p>
                <p><strong>Respaldos:</strong> Es responsabilidad del usuario realizar respaldos peri√≥dicos de sus datos. La p√©rdida de informaci√≥n por limpiar el cach√© del navegador, cambiar de dispositivo u otras causas no es responsabilidad del desarrollador.</p>
            </div>

            <div class="footer-copyright">
                <p>¬© 2025 Emp√≠rica Legal Lab. Todos los derechos reservados.</p>
                <p>TSJ Filing Online es una herramienta independiente no afiliada al Tribunal Superior de Justicia de Quintana Roo.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/juzgados.js"></script>
    <script src="js/database.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
